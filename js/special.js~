var window_width = screen.width
var window_height = screen.height
var loaded_script = []
var tag_list = [],tag_key=[]
var Tags = function(){
    var id
    var name
    var popularity
}
var Friend = function(){
    var id
    var uid
    var name
    var profile_pic
    var req_type
}
var freq = [],pfr=0,sfr=0
var open_menu,open_menu_initiator
var user_agent = navigator.userAgent
var browser
if(user_agent.toLowerCase().indexOf("chrome") > -1) {
    browser = 'chrome';
} else if (user_agent.toLowerCase().indexOf("safari") > -1) {
    browser = 'safari'
} else if (user_agent.toLowerCase().indexOf("opera") > -1) {
    browser = 'opera'
} else if (user_agent.toLowerCase().indexOf("firefox") > -1 || user_agent.toLowerCase().indexOf("netscape") > -1) {
    browser = 'mozilla'
} else if (user_agent.toLowerCase().indexOf("msie") > -1) {
    browser = 'msie'
}

getUpdates();

$(document).ready(function(){
    getRequests()
    $(document).click(function(e) {
        $(".sub_level").hide()
        var target = e.target || e.srcElement;
        while (target && !target.id) {
            target = target.parentNode
        }
        if(open_menu.length>0){
            if($(target).hasClass("open_menu")){
            }else{
                closeMenu()
            }
        }
    })
    
    if($(".user_drop_down").length>0){
        $(".user_drop_down").html("<table><tr><td class='uimg'></td><td style='padding-left:5px;'>"+user_name+"</td></tr></table>")
        $(".uimg").html(blur_profile_pic)
        blur_profile_pic.width(30)
        blur_profile_pic.height(30)
    }
    
    $("#container").css("width",window_width)
    if($("#dock_div").length>0){
        $("div#dock_div").css("margin-top",0.15*window_height)
        $("ul#dock li").css({
            "padding-top":0.00912*window_height,
            "padding-bottom":0.0208*window_height
        })
        $("#profile_dock a").attr("href","profile.php?id="+user_id)
        $("#vf_dock a").attr("href","friends.php?id="+user_id)
        $("#photos a").attr("href","setsgallery.php?id="+user_id)
        $("#intPage a").attr("href","interests.php?id="+user_id)
        
        var countdown
        $("#dock_div").show().delay(1500).hover(function(){
            clearTimeout(countdown)
        })
        countdown = setTimeout(function(){
            $("#dock_div").animate({
                "margin-left":"-82px"
            },300)
        },1500)
    }
    
    $(".user_drop_down").click(function(){
        if($("#user_drop").length==0){
            var user_drop = $("<div>")
            user_drop.attr({
                "id":"user_drop"
            })
            user_drop.html("<div>Account Settings</div><div>Privacy Settings</div><div id='logout_div' style='padding-top:5px;padding-bottom:5px;'><a href='logout.php'>Logout</a></div>")
            $(this).append(user_drop)
            $(this).addClass("uni_shadow_dark")
        }else{
            $("#user_drop").remove()
            $(this).removeClass("uni_shadow_dark")
        }
    })
    
    $("ul#dock li a").mouseover(function(){
        var src = $(this).find("img").attr("src")
        src = src.substring(0,src.indexOf("B"))+src.substring(src.indexOf("B")+1)
        $(this).find("img").attr("src",src)
    })
                    
    $("ul#dock li a").mouseout(function(){
        var src = $(this).find("img").attr("src")
        src = src.substring(0,src.indexOf("."))+"B."+src.substring(src.indexOf(".")+1)
        $(this).find("img").attr("src",src)
    })
                 
    $("ul#dock li").click(function(){
        $(".sub_level").hide()
        var scrollTop = $(window).scrollTop(),
        elementOffset = $(this).offset().top,
        distance      = (elementOffset - scrollTop)/1.2;
        $(this).children(".sub_level").css("top",distance);
        $(this).children(".sub_level").show();
    })
        
    $("#dock_div").hover(function(){
        $("#dock_div").animate({
            "margin-left":"0px"
        },300)
    },function(){
        $("#dock_div").animate({
            "margin-left":"-82px"
        },300)
        $(".sub_level").hide("slide",{
            direction:"left"
        },300)
    })
    
    $(".sla").hover(function(){
        $(this).children("a").css("color","white")
    },function(){
        $(this).children("a").css("color","#444")
    })
    
    $("ul#dock li").click(function(e) {
        if($(this).attr("id")=="friends"){
            e.stopPropagation()
            return false
        }
    })
                        
    $("#pfr_dock").click(function(){
        openRequestBox("pending");
    })
                                
    $("#sfr_dock").click(function(){
        openRequestBox("sent");
    })
    
    $("#vf_dock").click(function(){
        window.location="friends.php?id="+user_id
    })
    
    $(".hm_op").hover(function(){
        var img = $(this).find("img")
        var src = img.attr("src")
        src = src.substr(0,src.indexOf("."))+"_hover.png"
        img.attr("src",src)
    },function(){
        var img = $(this).find("img")
        var src = img.attr("src")
        src = src.substr(0,src.indexOf("_"))+".png"
        img.attr("src",src)
    })
    
    //Datepicker
    if($("input[type='datepicker']").length>0){
        var current_year = (new Date).getFullYear()
        $("input[type='datepicker']").datepicker({
            changeMonth:true,
            changeYear: true,
            dateFormat: 'dd-MM-yy',
            showAnim: 'slideDown',
            yearRange: '1900:'+current_year,
            onSelect: function(){
                var dateAsObject = $(this).datepicker( 'getDate' )
                var date = dateAsObject.getDate()
                var month = dateAsObject.getMonth()
                var year = dateAsObject.getYear()+1900
                var output = date+" "+getMonthName(month)+", "+year
                $("input[type='datepicker']").val(output)
            }
        })
        $("input[type='datepicker']").attr("readonly",true)
    }
})

function getRequests(){
    $.ajax({
        url:"manager/FriendManager.php",
        type:"get",
        cache:false,
        dataType:"json",
        data:"req=get_requests&user_id="+user_id,
        success:function(data){
            var i,data_length = data.length
            pfr=0,sfr=0
            freq=[]
            for(i=0;i<data_length;i++){
                freq[i]=new Friend()
                freq[i].req_type = data[i].req_type
                if(data[i].req_type=="pending")
                    pfr++
                else if(data[i].req_type=="sent")
                    sfr++
                freq[i].id = data[i].id
                freq[i].name = data[i].name
                freq[i].uid = data[i].uid
                freq[i].profile_pic = data[i].profile_pic
            }
        }
    })
}

function PostTile(detail){
    var id = detail.id
    var postType = detail.postType
    var title = detail.title
    var description = detail.description
    var src = detail.src
    var width = detail.width
    var height = detail.height
    var user_id = detail.user_id
    var likes = detail.likes
    var shares = detail.shares
    var comments = detail.comments
    var sharable = detail.sharable
    var date = detail.date
    var time = detail.time
    var element
    if(postType=="photo"){
        element = $("<img>")
        element.attr("src",src)
    }else if(postType=="video"){
        element = $("<embed>")
        element.attr({
            "src":src,
            "wmode":"transparent",
            "allowfullscreen":"true",
            "type":"application/x-shockwave-flash",
            "background":"black"
        })
    }
    
    this.arrangeTile = function(e,n,direction){
        var id = this.getId()
        var tile = $("<div>")
        var el = this.getElement()
        var title = this.getTitle()
        var description  = this.getDescription()
        var likes = this.getLikes()
        var comments = this.getComments()
        var shares = this.getShares()
        var tile_width = (e.width()-90)/n
        
        tile.attr("id","post_"+id)
        tile.addClass("tile")
        tile.html(el)
        
        var tile_board = $("<div>")
        tile_board.addClass("tile_board")
        if(title!=null && title.length!=0){
            tile_board.html("<div class='post_title'>"+decorateWithLinks(removeTags(title))+"</div>")
        }
        if(description!=null && description.length!=0){
            tile_board.append("<div class='post_description'>"+decorateWithLinks(removeTags(description))+"</div>")
        }
        tile.append(tile_board)
        
        var op_board = $("<div style='padding:10px;padding-left:15px;background:#f4f4f4;z-index:-1;'>")
        op_board.Like(id,"post")
        op_board.Comment(id,"post")
        op_board.Share(id,"post")
        tile.append(op_board)
        
        if(direction=="append")
            e.append(tile)
        else
            e.prepend(tile)
        tile.width(tile_width)
        el.imagesLoaded(function(){
            if(direction=="append"){
                e.masonry({
                    itemSelector: '.tile',
                    isAnimated:true
                })
            }else{
                e.masonry('reload')
            }
        })
        
        tile_board.click(function(){
            scriptLoader("postView", "postView",[[id]], 0, "")
        })
        el.click(function(){
            scriptLoader("postView", "postView",[[id]], 0, "")
        })
    }
    
    this.setId = function(id1){
        id = id1
    }
    this.setElement = function(element1){
        element = element1   
    }    
    this.setPostType = function(postType1){
        postType = postType1
    }
    this.setTitle = function(title1){
        title = title1
    }
    this.setDescription = function(description1){
        description = description1
    }
    this.setSrc = function(src1){
        src = src1
        if(postType=="photo"){
            element = $("<img>")
            element.attr("src",src)
        }else if(postType=="video"){
            element = $("<embed>")
            element.attr({
                "src":src,
                "wmode":"transparent",
                "allowfullscreen":"true",
                "type":"application/x-shockwave-flash",
                "background":"black"
            })
        }
    }
    this.setWidth = function(width1){
        width = width1
    }
    this.setHeight = function(height1){
        height = height1
    }
    this.setUser_id = function(user_id1){
        user_id = user_id1
    }
    this.setLikes = function(likes1){
        likes = likes1
    }
    this.setShares = function(shares1){
        shares = shares1
    }
    this.setComments = function(comments1){
        comments = comments1
    }
    this.setSharable = function(sharable1){
        sharable = sharable1
    }
    this.setDate = function(date1){
        date = date1
    }
    this.setTime = function(time1){
        time = time1
    }
    
    this.getId = function(){
        return id
    }
    this.getElement = function(){
        return element
    }
    this.getPostType = function(){
        return postType
    }
    this.getTitle = function(){
        return title
    }
    this.getDescription = function(){
        return description
    }
    this.getSrc = function(){
        return src
    }
    this.getWidth = function(){
        return width
    }
    this.getHeight = function(){
        return height
    }
    this.getUser_id = function(){
        return user_id
    }
    this.getLikes = function(){
        return likes
    }
    this.getShares = function(){
        return shares
    }
    this.getComments = function(){
        return comments
    }
    this.getSharable = function(){
        return sharable
    }
    this.getDate = function(){
        return date
    }
    this.getTime = function(){
        return time
    }
}

$.fn.addRatingWidget = function(out_of){
    var div = $(this),i,star=[]
    var rating = div.children("input").val()
    rating = 3
    rating = Math.round(rating)
    for(i=out_of-1;i>-1;i--){
        star[i] = $("<div class='star fl'>")
        if(i<rating){
            star[i].removeClass("star")
            star[i].addClass("star_gold")
        }
        div.prepend(star[i])
    }
}

$.fn.Like = function(id,type){
    var span = $("<span class='post_op'>")
    span.html("Like")
    var input = $("<input type='hidden' value='Like'>")
    span.append(input)
    $(this).append(span)
    span.click(function(){
        if(input.val()=="Like"){
            $.ajax({
                url:"PostManager.php",
                type:"get",
                cache:false,
                data:"req=like&type="+type+"&id="+id+"&user_id="+user_id,
                beforeSend:function(){
                    input.val("Unlike")
                    span.html("Unlike")
                    span.append(input)
                },
                success:function(like_id){
                    span.append("<input type='hidden' value='"+like_id+"' class='like_id'>")
                },
                error:function(e,f){
                    input.val("Like")
                    span.html("Like")
                    span.append(input)
                    alertBox("Some problem occured. Please try again later.")
                }
            })
        }else if(input.val()=="Unlike"){
            var like_id = span.children("input.like_id").val()
            $.ajax({
                url:"PostManager.php",
                type:"get",
                cache:false,
                data:"req=unlike&type="+type+"&post_id="+id+"&like_id="+like_id,
                beforeSend:function(){
                    input.val("Like")
                    span.html("Like")
                    span.append(input)
                },
                error:function(e,f){
                    input.val("Unlike")
                    span.html("Unlike")
                    span.append(input)
                    alertBox("Some problem occured. Please try again later.")
                }
            })
        }
    })
}

$.fn.Share = function(id){
    var span = $("<span class='post_op'>")
    span.html("Share")
    $(this).append(span)
    span.click(function(){
        })
}

$.fn.Comment = function(id){
    var span = $("<span class='post_op'>")
    span.html("Comment")
    $(this).append(span)
    span.click(function(){
       
        })
}

function closeMenu(){
    open_menu.hide('slide', {
        direction: 'up'
    }, 100)
    open_menu=null
    open_menu_initiator=null
}

function AjaxRequest(url,cache,type,dataType,data_array){
    var context = this,data="",i
    for(i=0;i<data_array.length;i++){
        data+=data_array[i][0]+"="+encodeURIComponent(data_array[i][1])+"&"
    }
    data = data.substr(0,data.length-1)
    
    this.sendRequest = function (){
        if(dataType==null || dataType.length==0){
            $.ajax({
                url:url,
                cache:cache,
                type:type,
                data:data,
                beforeSend:function(){
                    if(context.beforeSend!=null){
                        var function_name = context.beforeSend[0]
                        //                        var args = context.beforeSend[1]
                        window[function_name](data)
                    }
                },
                success: function(html){
                    if(context.success!=null){
                        var function_name = context.success[0]
                        //                        var args = context.success[1]
                        window[function_name](html)
                    }
                },
                complete:function(){
                    if(context.complete!=null){
                        var function_name = context.complete[0]
                        //                        var args = context.complete[1]
                        window[function_name]()
                    }
                },
                error: function(x,e,f){
                    if(context.error!=null){
                        var function_name = context.error[0]
                        //                        var args = context.error[1]
                        window[function_name]([e,f])
                    }else{
                        alert(e+" "+f)
                    }
                }
            })
        }else{
            $.ajax({
                url:url,
                cache:cache,
                type:type,
                dataType:dataType,
                data:data,
                beforesend:function(){
                    if(context.beforeSend!=null){
                        var function_name = context.beforeSend[0]
                        //                        var args = context.beforeSend[1]
                        window[function_name]()
                    }
                },
                success: function(html){
                    if(context.success!=null){
                        var function_name = context.success[0]
                        //                        var args = context.success[1]
                        window[function_name](html)
                    }
                },
                complete:function(){
                    if(context.complete!=null){
                        var function_name = context.complete[0]
                        //                        var args = context.complete[1]
                        window[function_name]()
                    }
                },
                error: function(e,f){
                    if(context.error!=null){
                        var function_name = context.error[0]
                        //                        var args = context.error[1]
                        window[function_name]([e,f])
                    }else{
                        alert(e,f)
                    }
                }
            })
        }
        
    }
}

function getMonthName(month){
    var month_name = ['January','February','March','April','May','June','July','August','September','October','November','December']
    return month_name[month*1]
}

function getMonthNumber(month_name){
    var month_name_array = ['January','February','March','April','May','June','July','August','September','October','November','December']
    var short_month_name_array = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
    var month_number = $.inArray(month_name,month_name_array)
    if(month_number==-1){
        month_number = $.inArray(month_name,short_month_name_array)
        if(month_number==-1){
            return 0
        }
    }
    return month_number + 1
}

function getStraightDate(dateFormat){
    var date_array = dateFormat.split("-")
    var date = date_array[2]
    var month = getMonthName(date_array[1])
    var year = date_array[0]
    return date+" "+month+", "+year
}

function validateEmailAddress(email_id){
    email_id = email_id.trim()
    if(email_id.length==0)
        return false
    var reg = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    return reg.test(email_id)
}

function validatePhoneNumber(ph_no){
    ph_no = ph_no.trim()
    if(ph_no.length==0)
        return false
    var reg = /^\d+$/
    return reg.test(ph_no)
}

function checkUserAge(dd,mm,yyyy){
    var valid_age = 13
    
    var current_year = (new Date).getFullYear()
    var current_month = (new Date).getMonth() + 1
    var current_date = (new Date).getDate()
    
    if(current_year - yyyy<valid_age){
        return false
    }else if(current_year - yyyy>valid_age){
        return true
    }else{
        if(current_month - mm < 0){
            return false
        }else if(current_month - mm > 0){
            return true
        }else{
            if(current_date - dd < 0){
                return false
            }else if(current_date - dd >= 0){
                return true
            }
        }
    }
}

function removeTags(string){
    return string.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g,"&gt;")
}

function decorateWithLinks(string){
    var pattern = /(http|https|ftp|ftps)\:\/\/[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,3}(\/\S*)?/g
    var exp = /(\b(https?|ftp|ftps|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
    return string.replace(exp,"<a href='$1'>$1</a>"); 
}

function centerFit(parent,childElementArray,margin,unit){
    var i
    for(i=0;i<childElementArray.length;i++){
        if(unit=="px"){
            childElementArray[i].width(parent.width()-(2*margin))
            childElementArray[i].css({
                "margin-left":margin
            })
        }
        else if(unit=="%"){
            childElementArray[i].width(parent.width()-(.02*margin*parent.width()))
            childElementArray[i].css({
                "margin-left":margin*parent.width()/100
            })
        }
    }
}

function ScreenSlider(screen_matrix){
    var cord_x = 0, cord_y = 0
    var window_width = $(window).width()
    var window_height = $(window).height()
    this.slideTo = function(destination_element_div,duration){
        var i,j,c = 0
        for(i=0;i<screen_matrix.length;i++){
            for(j=0;j<screen_matrix[i].length;j++){
                if(screen_matrix[i][j]==destination_element_div){
                    c = 1
                    break
                }
            }
            if(c==1){
                break
            }
        }
        this.slideHorizontal(screen_matrix,cord_x,cord_y,j,duration/(Math.abs(cord_x - j)),window_width)
        this.slideVertical(screen_matrix,cord_x,cord_y,i,duration/(Math.abs(cord_y - i)),window_height)
        cord_x = j
        cord_y = i
    }
    
    this.slideHorizontal = function(screen_matrix,cord_x,cord_y,j,duration,window_width){
        var context = this
        if(j > cord_x){
            $("#"+screen_matrix[cord_y][cord_x]).animate({
                "margin-left":-window_width
            },duration,"linear",function(){
                if(j >= cord_x + 1){
                    context.slideHorizontal(screen_matrix,cord_x+1,cord_y,j,duration,window_width)
                }
            })
        }else if(j < cord_x){
            $("#"+screen_matrix[cord_y][cord_x-1]).animate({
                "margin-left":0
            },duration,"linear",function(){
                if(j < cord_x - 1){
                    context.slideHorizontal(screen_matrix,cord_x-1,cord_y,j,duration,window_width)
                }
            })
        }
    }
    
    this.slideVertical = function(screen_matrix,cord_x,cord_y,i,duration,window_height){
        var context = this
        if(i > cord_y){
            $("#"+screen_matrix[cord_y][cord_x]).parent().animate({
                "margin-top":-window_height
            },duration,"linear",function(){
                if(i >= cord_y+1)
                    context.slideVertical(screen_matrix,cord_x,cord_y+1,i,duration,window_height)
            })
        }
        else if(i < cord_y){
            $("#"+screen_matrix[cord_y - 1][cord_x]).parent().animate({
                "margin-top":0
            },duration,"linear",function(){
                if(i < cord_y-1)
                    context.slideVertical(screen_matrix,cord_x,cord_y-1,i,duration,window_height)
            })
        }
    }
}

$.fn.carousel = function(img_set,cols,rows){
    var frames = [],k=-1,i,cnt = cols*rows,info_arena = $(this).parent()
    var caller_width = $(this).width(),caller_height = $(this).height()
    var per_width = (caller_width/cols)-4
    for(i=0;i<img_set.length;i++){
        if(i%cnt==0){
            k++
            if(k==0)
                frames[k] = $("<div id='frame_"+k+"' style='width:"+caller_width+"px;height:"+caller_height+"px;overflow:hidden;float:left;position:absolute;' class='current_frame'>")
            else
                frames[k] = $("<div id='frame_"+k+"' style='width:"+caller_width+"px;height:"+caller_height+"px;overflow:hidden;float:left;position:absolute;display:none;'>")
            $(this).append(frames[k])
        }
        var spost = $("<div style='overflow:hidden;width:"+per_width+"px;height:"+per_width+"px;margin:1px;background:#fcfcfc;' class='fl cp'>")
        spost.html(img_set[i])
        frames[k].append(spost)
        spost.children("img").hover(function(){
            $(this).fadeTo("fast",0.5)
        },function(){
            $(this).fadeTo("fast",1)
        })
    }
    var left = $("<input type='button' value='Left'>")
    var right = $("<input type='button' value='Right'>")
    left.click(function(){
        var cf = $(".current_frame")
        var frame_number = cf.attr("id").substr(6)
        var nf = $("#frame_"+((frame_number*1)+1))
        cf.removeClass("current_frame")
        cf.hide("slide",{
            direction:"left"
        },700)
        nf.show("slide",{
            direction:"right"
        },700)
        nf.addClass("current_frame")
    })
    right.click(function(){
        var cf = $(".current_frame")
        var frame_number = cf.attr("id").substr(6)
        var nf = $("#frame_"+(frame_number-1))
        cf.removeClass("current_frame")
        cf.hide("slide",{
            direction:"right"
        },700)
        nf.show("slide",{
            direction:"left"
        },700)
        nf.addClass("current_frame")
    })
//    info_arena.append(left)
//    info_arena.append(right)
}

$.fn.photostack = function(pic1,pic2,pic3,current_class){
    $(this).live({
        mouseenter: function () {
            if ($(this).find("img").hasClass(current_class)) {
                //attach the css class rotate1 , rotate2 and rotate3 to each image in the stack to rotate the images to specific degrees
                var $parent = $(this);
                $parent.find('img#'+pic1).addClass('rotate1');
                $parent.find('img#'+pic2).addClass('rotate2');
                $parent.find('img#'+pic3).addClass('rotate3');
                $parent.find('img#'+pic1).css("left","150px");//reposition the last and first photo
                $parent.find('img#'+pic3).css("left","50px");

            }
        },
        mouseleave: function () {
            $('img#'+pic1).removeClass('rotate1');
            $('img#'+pic2).removeClass('rotate2');
            $('img#'+pic3).removeClass('rotate3');
            $('img#'+pic1).css("left","");
            $('img#'+pic3).css("left","");
        }
    })
}

$.fn.multichoice = function(title,options,no_of_columns,width,max_open_height){
    this.html(title+"<div class='down_arrow' style='float:right;margin-top:20px;' id='mc_"+$(this).attr("id")+"'></div>")
    if(width==null)
        width="100%"
    $(this).width(width)
    $(this).addClass("multichoice")
    $(this).hover(function(){
        $("#mc_"+$(this).attr("id")).css("border-top-color","#14b30e")
    },function(){
        $("#mc_"+$(this).attr("id")).css("border-top-color","#007dff")
    })
    this.click(function(){
        if($(".multichoice_open").length>0){
            $(".multichoice_open").remove()
            $("#mc_"+$(this).attr("id")).css("border-top-color","#007dff")
        }
        else{
            var outputString="<div class='multichoice_open' id='mo_"+$(this).attr("id")+"'><table>"
            var i,j,k=0
            var no_of_rows = options.length/no_of_columns
            if(options.length%no_of_columns!=0)
                no_of_rows++
            for(i=0;i<no_of_rows;i++){
                outputString+="<tr>"
                for(j=0;j<no_of_columns;j++){
                    if(k<options.length){
                        if(title==options[k][1])
                            outputString+="<td class='mo_selected' id='mc_option"+options[k][0]+"'>"+options[k][1]+"</td>"
                        else
                            outputString+="<td id='mc_option"+options[k][0]+"'>"+options[k][1]+"</td>"
                        k++
                    }else
                        break
                }
                outputString+="</tr>"
            }
            outputString+="</table></div>"
            $(this).append(outputString)
            $("#mo_"+$(this).attr("id")).width(230*no_of_columns)
            if(max_open_height!=null){
                $("#mo_"+$(this).attr("id")).height(max_open_height)
                $("#mo_"+$(this).attr("id")).css("overflow","auto")
            }
        }
    })
}

$.fn.autoSuggest = function(purpose,text,width,placeholder,tagger){
    $(".autosuggest").remove()
    var text_length = text.length
    if(text_length==0){
        $(".autosuggest").remove()
        return
    }
    var auto_suggest = $("<ul class='autosuggest'>")
    auto_suggest.width(width)
    var input = this
    if(purpose=="interest"){
        var list_length = tag_list.length,i
        for(i=0;i<list_length;i++)
        {
            if((tag_list[i].name).substr(0,text_length)==text){
                var li = $("<li>")
                li.html("<input type='hidden' value='"+tag_list[i].id+"' id='as"+i+"'>")
                li.append("<span>"+tag_list[i].name+"</span>")
                auto_suggest.append(li)
                    
                li.click(function(){
                    input.val($(this).children("span").html())
                    $(".autosuggest").remove()
                    addAsTag(input,placeholder,tagger,$(this).children("input").val())
                })
            }
        }
        input.parent().append(auto_suggest)
    }
}

function addAsTag(input,placeholder,tagger,id){
    var tag = input.val().trim(),hi,i
    if(id==null){
        var list_length = tag_list.length
        for(i=0;i<list_length;i++)
        {
            if((tag_list[i].name)==tag){
                hi = $("<input type='hidden' value='"+tag_list[i].id+"'>")
                break
            }
        }
        if(i==list_length)
            hi = $("<input type='hidden' value=''>")
    }else{
        hi = $("<input type='hidden' value='"+id+"'>")
    }
    input.val("")
    var tagdiv = $("<div class='tag'>")
    tagdiv.html("<span class='val'>"+tag+"</span>")
    tagdiv.append(hi)
    var cantag = $("<span class='cantag'>")
    cantag.html("x")
    cantag.click(function(){
        tagdiv.remove()
        hi.remove()
        if($(".cantag").length==0){
            input.attr("placeholder",placeholder)
        }
    })
    tagdiv.append(cantag)
    tagger.append(tagdiv)
    input.remove()
    tagger.append(input)
    input.removeAttr("placeholder")
    input.focus()
    
    var curposition = -1
    input.keyup(function(e){
        var keyCode = e.keyCode
        if(keyCode==38 || keyCode==40){
            var as = $(".autosuggest"),cnt=0
            as.find("li").each(function(){
                cnt++
            })
            if(as){
                if(keyCode==38){
                    if(curposition>0)
                        curposition--
                    as.find("#as"+curposition).each(function(){
                        $(".autosuggest_li_hover").removeClass("autosuggest_li_hover")
                        $(this).addClass("autosuggest_li_hover")
                    })
                }else if(keyCode==40){
                    if(curposition<cnt)
                        curposition++
                    as.find("#as"+curposition).each(function(){
                        $(".autosuggest_li_hover").removeClass("autosuggest_li_hover")
                        $(this).addClass("autosuggest_li_hover")
                    })
                }
            }
        }
    })
}

$.fn.addTagger = function(placeholder,tagManager){
    var tagger = $(this)
    tagger.addClass("tagger")
    tagger.attr({
        "tabindex":"-1"
    })
    var input = $("<input type='text' placeholder='"+placeholder+"' class='ac'>")
    tagger.html(input)
    
    input.blur(function(){
        tagger.css({
            "background":"#fcfcfc"
        })
    })
    
    this.keyup(function(e){
        if(e.keyCode==13){
            if((input.val().trim()).length>0){
                $(".autosuggest").remove()
                addAsTag(input,placeholder,tagger,null)
            }
        }else{
            var tag = input.val().trim()
            input.autoSuggest("interest",tag,tagger.width(),placeholder,tagger)
            if(tag.length==3){
                if($.inArray(tag,tag_key)==-1){
                    tag_key.push(tag)
                    $.ajax({
                        url:"manager/"+tagManager+".php",
                        cache:false,
                        type:"get",
                        dataType:"json",
                        data:"req=get_tags_by_key&key="+tag,
                        beforeSend:function(){

                        },
                        success:function(data){
                            var i,data_length = data.length
                            var cur_size = tag_list.length
                            for(i=0;i<data_length;i++){
                                tag_list[i+cur_size] = new Tags()
                                tag_list[i+cur_size].id = data[i].id
                                tag_list[i+cur_size].name = data[i].name
                                tag_list[i+cur_size].popularity = data[i].popularity
                            }
                        },
                        error:function(e,f){
                            
                        }
                    })
                }
            }
        }
    })
    
    this.click(function(){
        $(this).find("input").focus()
        $(this).css({
            "background":"white"
        })
    })
    this.hover(function(){
        input.css("background","white")
        $(this).css({
            "background":"white"
        })
    },function(){
        input.css("background","#fcfcfc")
        $(this).css({
            "background":"#fcfcfc"
        })
    })
}

$.fn.fitImage = function(img,photo_width,photo_height,flex){
    var image_container = $(this)
    var w,h,mgn_top,mgn_left
    if(flex=="both"){
        if(photo_width<image_container.width() && photo_height<image_container.height()){
            w = photo_width
            h = photo_height
            mgn_top = (image_container.height() - h)/2
            mgn_left = (image_container.width() - w)/2
            img.width(w)
            img.height(h)
            img.css({
                "margin-left":mgn_left,
                "margin-top":mgn_top
            })
        }else if(photo_width>image_container.width() && photo_height<image_container.height()){
            w = image_container.width() - 5
            h = (photo_height/photo_width)*w
            mgn_top = (image_container.height() - h)/2
            img.width(w)
            img.height(h)
            img.css({
                "margin-top":mgn_top
            })
        }else if(photo_width<image_container.width() && photo_height>image_container.height()){
            h = image_container.height() - 5
            w = (photo_width/photo_height)*h
            mgn_left = (image_container.width() - w)/2
            img.height(h)
            img.width(w)
            img.css({
                "margin-left":mgn_left
            })
        }else{
            var icw = image_container.width(),ich = image_container.height()
            if(icw/ich<w/h){
                w = image_container.width() - 5
                h = w*(photo_height/photo_width)
                mgn_top = (image_container.height() - h)/2
                img.height(h)
                img.width(w)
                img.css({
                    "margin-top":mgn_top
                })
            }else{
                h = image_container.height() - 5
                w = h*(photo_width/photo_height)
                mgn_left = (image_container.width() - w)/2
                img.height(h)
                img.width(w)
                img.css({
                    "margin-left":mgn_left
                })
            }
        }
    }
    var width_input = $("<input type='hidden' value='"+photo_width+"' class='wi'>")
    var height_input = $("<input type='hidden' value='"+photo_height+"' class='hi'>")
    var width_output = $("<input type='hidden' value='"+w+"' class='wo'>")
    var height_output = $("<input type='hidden' value='"+h+"' class='ho'>")
    image_container.html(img)
    image_container.append(width_input)
    image_container.append(height_input)
    image_container.append(width_output)
    image_container.append(height_output)
}

$.fn.customSelect = function(options,placeholder){
    var select = $(this),i,main_area = $("<div class='fl'>")
    select.html(main_area)
    select.css({
        "display":"table"
    })
    main_area.width(select.width()-30)
    select.addClass("customSelect")
    var selected_id = $("<input type='hidden'>")
    var selected_name = $("<span>")
    var pl = select.attr("id")+"_pl"
    if(placeholder!=null && placeholder.length>0){
        main_area.html("<span style='color:#999;font-size:15px;font-family:arial' id='"+pl+"'>"+placeholder+"</span>")
    }else{
        main_area.html(selected_id)
        main_area.append(selected_name)
    }
    
    var down_arrow = $("<div class='down_arrow fr mr1 mt1'>")
    down_arrow.css({
        "border-top-color":"#666"
    })
    select.hover(function(){
        down_arrow.css({
            "border-top-color":"#007dff"
        })
        select.css({
            "background":"#fff"
        })
    },function(){
        down_arrow.css({
            "border-top-color":"#666"
        })
        select.css({
            "background":"#fcfcfc"
        })
    })
    select.append(down_arrow)
    
    var list = $("<ul>")
    list.addClass("dropdown")
    list.addClass("uni_shadow_lightest")
    list.css({
        "width":select.width()+5,
        "margin-left":"-5px",
        "margin-top":"6px",
        "max-height":"700px",
        "overflow":"auto"
    })
    for(i=0;i<options.length;i++){
        var option = $("<li>")
        option.css({
            "padding":"10px"
        })
        var id = $("<input type='hidden'>")
        id.val(options[i].id)
        var name = $("<span>")
        name.html(options[i].name)
        option.html(id)
        option.append(name)
        list.append(option)
        
        option.click(function(){
            selected_id.val($(this).children("input").val())
            selected_name.html($(this).children("span").html())
            if($("#"+pl).length>0){
                $("#"+pl).remove()
                main_area.prepend(selected_name)
                main_area.prepend(selected_id)
            }
            list.hide("slide",{
                direction:"up"
            },400)
            select.css({
                "background":"#fcfcfc"
            })
        })
    }
    main_area.append(list)
    
    select.click(function(){
        if(list.is(":hidden")){
            list.show("slide",{
                direction:"up"
            },400)
            select.css({
                "background":"#fff"
            })
        }
    })
}

$.fn.privacyButton = function(privacy){
    var privacy_button = $(this)
    var privacy_value = $("<input type='hidden'>")
    var active = 0
    privacy_button.addClass("privacy_button")
    privacy_button.width("100px")
    privacy_button.html("<img src='img/public.png' style='height:17px'>")
    privacy_button.append(privacy_value)
    if(privacy==null){
        privacy_button.append("<label>Public</label>")
        privacy_value.val(0)
    }
    else{
        if(privacy==0){
            privacy_button.append("<label>Public</label>")
        }else{
            privacy_button.append("<label>Friends</label>")
        }
        privacy_value.val(privacy)
    }
    
    privacy_button.hover(function(){
        privacy_button.css("border","1px solid #ccc")
    },function(){
        if(active==0){
            privacy_button.css("border","1px solid white")
        }
    })
    
    var ul = $("<ul class='dropdown' id='set_pb'>"),public_option = $("<li>"),friends_option = $("<li>")
    
    ul.width(privacy_button.width()+2)
    if(browser=='chrome'){
        ul.css("margin-left",-privacy_button.width())
    }else if(browser=='msie' || browser=='mozilla'){
        ul.css("margin-left",-privacy_button.width()-2)
    }
    ul.css({
        "box-shadow": "0 3px 7px #ccc",
        "-o-box-shadow": "0 3px 7px #ccc",
        "-webkit-box-shadow": "0 3px 7px #ccc",
        "-moz-box-shadow": "0 3px 7px #ccc"
    })
    
    public_option.html("<input type='hidden' value='0'>")
    public_option.append("<img src='img/public.png' style='height:17px;float:left;'><span style='margin-left:4px;font-weight:bold;color:#777'>Public</span>")
    public_option.css("padding","5px")
    public_option.hover(function(){
        public_option.children("span").css("color","white")
        var img =  public_option.find("img")
        var src = img.attr("src")
        src = src.substr(0,src.indexOf("."))+"_white.png"
        img.attr("src",src)
    },function(){
        public_option.children("span").css("color","#777")
        var img =  public_option.find("img")
        var src = img.attr("src")
        src = src.substr(0,src.indexOf("_"))+".png"
        img.attr("src",src)
    })
    ul.html(public_option)
    
    friends_option.html("<input type='hidden' value='1'>")
    friends_option.append("<img src='img/friendreq.png' style='height:17px;float:left;'><span style='margin-left:4px;font-weight:bold;color:#777'>Friends</span>")
    friends_option.css("padding","5px")
    friends_option.hover(function(){
        friends_option.children("span").css("color","white")
        var img = friends_option.find("img")
        var src = img.attr("src")
        src = src.substr(0,src.indexOf("."))+"_white.png"
        img.attr("src",src)
    },function(){
        friends_option.children("span").css("color","#777")
        var img = friends_option.find("img")
        var src = img.attr("src")
        src = src.substr(0,src.indexOf("_"))+".png"
        img.attr("src",src)
    })
    ul.append(friends_option)
    
    privacy_button.click(function(){
        if(active==0){
            active = 1
            privacy_button.addClass("uni_shadow_lightest")
            privacy_button.css({
                "border":"1px solid #ccc"
            })
            
            if(privacy_value.val()==1){
                friends_option.hide()
                public_option.show()

            }else{
                public_option.hide()
                friends_option.show()
            }
            privacy_button.append("<br>")
            privacy_button.append(ul)
            ul.show()
        }
    })
    
    friends_option.click(function(){
        privacy_value.val(1)
        privacy_button.children("img").attr("src","img/friendreq.png")
        privacy_button.children("label").html("Friends")
        privacy_button.children("br").remove()
        ul.hide()
        privacy_button.removeClass("uni_shadow_lightest")
        privacy_button.css("border","1px solid white")
        setTimeout(function(){
            active=0
        },5)
    })
    
    public_option.click(function(){
        privacy_value.val(0)
        privacy_button.children("img").attr("src","img/public.png")
        privacy_button.children("label").html("Public")
        privacy_button.children("br").remove()
        ul.hide()
        privacy_button.removeClass("uni_shadow_lightest")
        privacy_button.css("border","1px solid white")
        setTimeout(function(){
            active=0
        },5)
    })
    
}

//Alertbox
function alertBox(msg){
    var outputString="<div id='alertBoxFade' class='white_overlay'></div>";
    outputString+="<div id='alertBox'>";
    outputString+="<div id='alertBox_header'class='light_header'><label>Message</label></div>";
    outputString+="<div class='msg'>"+msg+"</div>";
    outputString+="<div id='alertBox_buttons'><center><input type='button' value='OK' class='bbutton' id='alertBox_ok' style='width:70px;' onclick='alertBox_close()'></center></div></div>";
    $("body").append(outputString);
    
    $("#alertBox").css("left",0.3*window_width);
    $("#alertBox").css("width",0.4*window_width);
    
    var height = $("#alertBox").height();
    height = height/window_height;
    var top = (1 - height)/2;
    $("#alertBox").css("top",top*window_height);
}

function alertBox_close(){
    $("body").children("#alertBox").remove();
    $("#alertBoxFade").remove();
}

function listUpdates(){
	$("#update_list").show("slide",{direction:"up"},700)
}

//Create Menu
function createMenu(e){  
    open_menu = $(e).parent().children("ul")
    open_menu_initiator = $(e)
    open_menu.show('slide', {
        direction: 'up'
    }, 100)
}

//Box constructs
function Box(box_id,width,height){
    var overlay = [box_id+"_overlay","white"]
    var loading = true
    var loading_image = "img/big_ajax_loader.gif"
    var loading_text
    var horizontal_position = "center"
    var vertical_position = "center"
    var entry_animation = ["appear","",0]
    var exit_animation = ["appear","",0]
    var no_head = false
    var heading
    var buttons = []
    var context = this
    
    this.createOverlay = function(removeOnClick){
        var overlay_element,overlay_id,overlay_type
        if(this.overlay==undefined){
            overlay_id = overlay[0]
            overlay_type = overlay[1]
        }else{
            overlay_id = this.overlay[0]
            overlay_type = this.overlay[1]
        }
        if(overlay_type=="transparent")
            overlay_element = $("<div>").addClass("t_overlay")
        else
            overlay_element = $("<div>").addClass("white_overlay")
        overlay_element.attr("id",overlay_id)
        $("body").append(overlay_element)
        overlay_element.click(function(){
            if(removeOnClick==1){
                context.closeBox()
            }
        })
    }
    
    this.createBox = function(){
        var margin_left = (1 - width/100)*(screen.width)/2
        var margin_top = (1 - height/100)*(screen.height)/2
        var entry_animation_effect,entry_animation_direction,entry_animation_duration,exit_animation_effect,exit_animation_direction,exit_animation_duration
        if(this.entry_animation==undefined){
            entry_animation_effect = entry_animation[0]
            entry_animation_direction = entry_animation[1]
            entry_animation_duration = entry_animation[2]
        }else{
            entry_animation_effect = this.entry_animation[0]
            entry_animation_direction = this.entry_animation[1]
            entry_animation_duration = this.entry_animation[2]
        }
        if(this.exit_animation==undefined){
            exit_animation_effect = exit_animation[0]
            exit_animation_direction = exit_animation[1]
            exit_animation_duration = exit_animation[2]
        }else{
            exit_animation_effect = this.exit_animation[0]
            exit_animation_direction = this.exit_animation[1]
            exit_animation_duration = this.exit_animation[2]
        }
        
        var box = $("<div>")
        box.attr("id",box_id)
        box.addClass("front_box")
        box.css({
            "width":width*(screen.width)/100,
            "height":height*(screen.height)/100 
        })
        
        var close_button,head_label,box_head
        box_head = $("<div>")
        box_head.attr("id",box_id+"_head")
        box_head.addClass("light_header")
            
        head_label = $("<label>")
        head_label.html(this.heading)
            
        close_button = $("<label>")
        close_button.html("X")
        close_button.addClass("box_close")
        if(this.no_head==false || this.no_head==null){
            box.append(box_head)
            box_head.append(head_label)
            box_head.append(close_button)
        }

        var main_body = $("<div>")
        main_body.addClass("box_main_body")
        if(this.no_head==false || this.no_head==null)
            main_body.height(box.height() - 41)
        else
            main_body.height(box.height())
        box.append(main_body)
        
        if(this.buttons==undefined){
            var button_div = $("<div>")
            box.append(button_div)
        }
        
        box.css({
            "margin-left":margin_left,
            "margin-top":margin_top-50
        })
        
        if(entry_animation_effect=="appear"){
            $("body").prepend(box)
        }else if(entry_animation_effect=="fly"){
            $("body").prepend(box)
            box.hide()
            if(entry_animation_direction=="up"){
                box.show("slide",{
                    direction:"up"
                },entry_animation_duration)
            }else if(entry_animation_direction=="down"){
                box.show("slide",{
                    direction:"down"
                },entry_animation_duration)
            }else if(entry_animation_direction=="left"){
                box.show("slide",{
                    direction:"left"
                },entry_animation_duration)
            }else if(entry_animation_direction=="right"){
                box.show("slide",{
                    direction:"right"
                },entry_animation_duration)
            }
        }else if(entry_animation_effect=="book_open"){
            box.addClass("page")
            $("body").prepend(box)
            box.parent().addClass("perspectiveClass")
            if(entry_animation_direction=="up"){
                box.show("slide",{
                    direction:"up"
                },entry_animation_duration)
            }else if(entry_animation_direction=="down"){
                box.show("slide",{
                    direction:"down"
                },entry_animation_duration)
            }else if(entry_animation_direction=="left"){
                box.addClass("open_left")
            }
            else if(entry_animation_direction=="right"){
                box.show("slide",{
                    direction:"right"
                },entry_animation_duration)
            }
        }
        
        this.closeBox = function(){
            var overlay_id
            if(this.overlay==undefined){
                overlay_id = overlay[0]
            }else{
                overlay_id = this.overlay[0]
            }
            if(exit_animation_effect=="appear"){
                $("#"+overlay_id).remove()
                $("#"+box_id).remove()
            }else if(exit_animation_effect=="fly"){
                if(exit_animation_direction=="up"){
                    box.hide("slide",{
                        direction:"up"
                    },entry_animation_duration)
                }else if(exit_animation_direction=="down"){
                    box.hide("slide",{
                        direction:"down"
                    },entry_animation_duration)
                }else if(exit_animation_direction=="left"){
                    box.hide("slide",{
                        direction:"left"
                    },entry_animation_duration)
                }
                else if(exit_animation_direction=="right"){
                    box.hide("slide",{
                        direction:"right"
                    },entry_animation_duration)
                }
            }
        }
        
        close_button.click(function(){
            context.closeBox()
        })
        return main_body
    }
}

function scriptLoader(script_name,function_to_call,params,allow,caller){
    //params is 2d array...i for funtion j for args
    var script_url = "js/"+script_name+".js"
    caller = $(caller)
    var caller_html = caller.html()
    var function_array = function_to_call.split(","),i
    if($.inArray(script_name,loaded_script)==-1){
        if(allow==1)
        {
            var img = $("<img src='img/ajax_loader_horizontal.gif'>")
            caller.html(img)
        }else{
            var div = $("<div>")
            div.addClass("white_overlay")
            div.html("<center><img src='img/massive_ajax_loader.gif'></center>")
            div.find("center").css({
                "margin-top":"50px"
            })
            $("body").append(div)
        }
        $.getScript(script_url, function(){
            for(i=0;i<function_array.length;i++)
            {
                window[function_array[i]](params[i])
            }
            if(allow==1)
                caller.html(caller_html)
            else
                div.remove()
        })
        loaded_script.push(script_name)
    }else{
        for(i=0;i<function_array.length;i++)
        {
            window[function_array[i]](params[i])
        }
    }
}

function getPost(e,id){
    var center = $("<center id='post_loader'>")
    $.ajax({
        url:"manager/PostManager.php",
        cache:false,
        type:"GET",
        dataType:"json",
        data:"req=get_post&id="+id,
        beforeSend:function(){
            var feed_loader = $("<img style='position:absolute;width:50px;margin-top:80px'>")
            feed_loader.attr("src","img/massive_ajax_loader.gif")
            center.html(feed_loader)
            e.append(center)
        },
        success:function(data){
            center.remove()
            var post = new PostTile(data)
            post.arrangeTile(e,4,"prepend")
        }
    })
}

function getUpdates(){
	$.ajax({
		url:"manager/UpdateManager.php",
		type:"get",
		dataType:"json",
		data:"req=get_updates&user_id=17&type=all",
		success:function(updates){
			var i
			for(i=0;i<updates.length;i++){
				var ublock = $("<div class='ublock cp' id='"+updates[i].id+"' onclick='window.location.href=\""+updates[i].url+"\"'>")
				var uimg_div = $("<div class='uimg_div'>")
				var uimg = $("<img src='"+updates[i].img+"'>")
				var udesc_div = $("<div class='udesc'>")
				var udesc = updates[i].description
				uimg_div.html(uimg)
				udesc_div.html(udesc)
				ublock.html(uimg_div)
				ublock.append(udesc_div)
				$("#ulist").prepend(ublock)
				ublock.hover(function(){
					$(this).css({
						"background":"#007dff",
					})
					$(this).children(".udesc").css("color","white")
				},function(){
					$(this).css({
						"background":"white",
					})
					$(this).children(".udesc").css("color","#999")
				})
				setTimeout("getUpdates()",7000)
			}
		}
	})
}

function openRequestBox(p){
    var i
    var reqbox = new Box("reqbox", "35", "70")
    reqbox.heading="Friend Requests"
    reqbox.createOverlay(1)
    var main_body = reqbox.createBox()
    
    var type = $("<table style='width:100%;' class='sub_menu'>")
    var tr = $("<tr>")
    var pft = $("<td style='width:50%;border-right:1px solid #ccc;text-align:center;padding-top:10px;padding-bottom:10px;' class='cp black_link'>")
    var sft = $("<td style='width:50%;text-align:center;padding-top:5px;padding-bottom:5px;' class='cp black_link'>")
    pft.html("Pending Friend Requests")
    sft.html("Sent Friend Requests")
    tr.html(pft)
    tr.append(sft)
    type.html(tr)
    main_body.html(type)
    
    var req_block = $("<div style='width:100%;overflow:auto;overflow-x:hidden;'>")
    main_body.append(req_block)
    req_block.height(main_body.height()-type.height()-20)
    
    pft.click(function(){
        if($(this).hasClass("crt")==false){
            pft.addClass("black_link_active")
            sft.removeClass("black_link_active")
            sft.removeClass("crt")
            req_block.html("")
            enlist("pending",req_block)
        }
    })
    
    sft.click(function(){
        if($(this).hasClass("crt")==false){
            sft.addClass("black_link_active")
            pft.removeClass("black_link_active")
            pft.removeClass("crt")
            req_block.html("")
            enlist("sent",req_block)
        }
    })
    
    if(p=="pending"){
        pft.addClass("black_link_active")
        pft.addClass("crt")
    }else if(p=="sent"){
        sft.addClass("crt")
        sft.addClass("black_link_active")
    }
    
    enlist(p,req_block)
}

function enlist(p,req_block){
    if(p=="pending" && pfr==0){
        req_block.html("<span style='font-size:18px;color:#555;margin:20px;'>No pending requests for you</span>")
        return
    }else if(p=="sent" && sfr==0){
        req_block.html("<span style='font-size:18px;color:#555;margin:20px;'>You haven't sent any requests</span>")
        return
    }
    var i,freq_length = freq.length
    for(i=0;i<freq_length;i++){
        if(p==freq[i].req_type){
            var block = $("<div class='med_list_hoverless'>")
            var img = $("<img class='rounded' style='width:40px;height:40px;margin-left:1px;'>")
            img.attr("src",freq[i].profile_pic)
            block.html(img)
            var name = $("<a class='ml1' style='vertical-align:top' href='profile.php?id="+freq[i].uid+"'>")
            name.html(freq[i].name)
            block.append(name)
            if(p=="pending"){
                var accept = $("<input type='button' class='gbutton fr' value='Accept' style='width:80px;margin-right:10px;' frid='"+freq[i].id+"'>")
                var reject = $("<input type='button' class='wbutton fr' value='Reject' style='width:80px;margin-right:40px;' frid='"+freq[i].id+"'>")
                block.append(reject)
                block.append(accept)
                accept.click(function(){
                    decideReq("accept",$(this).attr("frid"),"reqBox",$(this).parent())
                })
                reject.click(function(){
                    decideReq("reject",$(this).attr("frid"),"reqBox",$(this).parent())
                })
            }else if(p=="sent"){
                var cancel = $("<input type='button' class='wbutton fr' value='Cancel' style='width:80px;margin-right:40px;' frid='"+freq[i].id+"'>")
                block.append(cancel)
                cancel.click(function(){
                    cancelReq($(this).attr("frid"),"reqBox",$(this).parent())
                })
            }
            req_block.append(block)
        }
    }
}

function cancelReq(id,fr,block){
    var loading = $("<img src='img/ajax_loader_horizontal.gif' class='fr mt1' style='margin-right:120px;'>")
    $.ajax({
        url:"manager/FriendManager.php",
        type:"get",
        cache:false,
        data:"req=cancel&id="+id,
        beforeSend:function(){
            if(fr=="reqBox"){
                block.children("input").hide()
                block.append(loading)
            }
        },
        success:function(flag){
            if(fr=="reqBox"){
                if(flag==1 || flag==2){
                    block.hide("slide",{
                        direction:"up"
                    },300,function(){
                        block.remove()
                    })
                    var i,k,cnt=0
                    for(i=0;i<freq.length;i++){
                        if(freq[i].id==id){
                            k = i
                            break
                        }
                        if(freq[i].req_type=="sent"){
                            cnt++
                        }
                    }
                    freq.splice(k,1)
                    if(cnt==0){
                        block.parent().html("<span style='font-size:18px;color:#555;margin:20px;'>You haven't sent any requests</span>")
                        sfr=0
                    }
                }else{
                    loading.remove()
                    block.children("input").show()
                }
            }
        },
        error:function(e,f){
            alertBox("Some error occured. Please try again later.")
            loading.remove()
            block.children("input").show()
        }
    })
}

function decideReq(decision,id,fr,block){
    var loading = $("<img src='img/ajax_loader_horizontal.gif' class='fr mt1' style='margin-right:120px;'>")
    $.ajax({
        url:"manager/FriendManager.php",
        type:"get",
        cache:false,
        data:"req="+decision+"&id="+id,
        beforeSend:function(){
            if(fr=="reqBox"){
                block.children("input").hide()
                block.append(loading)
            }
        },
        success:function(flag){
            if(fr=="reqBox"){
                if(flag==1 || flag==2){
                    block.hide("slide",{
                        direction:"up"
                    },300)
                    var i,k,cnt=0
                    for(i=0;i<freq.length;i++){
                        if(freq[i].id==id){
                            k=i
                            break
                        }
                        if(freq[i].req_type=="pending"){
                            cnt++
                        }
                    }
                    freq.splice(k,1)
                    if(cnt==0){
                        req_block.html("<span style='font-size:18px;color:#555;margin:20px;'>No pending requests for you</span>")
                        pfr=0
                    }
                }else{
                    loading.remove()
                    block.children("input").show()
                }
            }
        },
        error:function(e,f){
            alertBox("Some error occured. Please try again later.")
            loading.remove()
            block.children("input").show()
        }
    })
}

//placeholder UI
(function(b){
    function d(a){
        this.input=a;
        a.attr("type")=="password"&&this.handlePassword();
        b(a[0].form).submit(function(){
            if(a.hasClass("placeholder")&&a[0].value==a.attr("placeholder"))a[0].value=""
        })
    }
    d.prototype={
        show:function(a){
            if(this.input[0].value===""||a&&this.valueIsPlaceholder()){
                if(this.isPassword)try{
                    this.input[0].setAttribute("type","text")
                }catch(b){
                    this.input.before(this.fakePassword.show()).hide()
                }
                this.input.addClass("placeholder");
                this.input[0].value=this.input.attr("placeholder")
            }
        },
        hide:function(){
            if(this.valueIsPlaceholder()&&this.input.hasClass("placeholder")&&(this.input.removeClass("placeholder"),this.input[0].value="",this.isPassword)){
                try{
                    this.input[0].setAttribute("type","password")
                }catch(a){}
                this.input.show();
                this.input[0].focus()
            }
        },
        valueIsPlaceholder:function(){
            return this.input[0].value==this.input.attr("placeholder")
        },
        handlePassword:function(){
            var a=this.input;
            a.attr("realType","password");
            this.isPassword=!0;
            if(b.browser.msie&&a[0].outerHTML){
                var c=b(a[0].outerHTML.replace(/type=(['"])?password\1/gi,
                    "type=$1text$1"));
                this.fakePassword=c.val(a.attr("placeholder")).addClass("placeholder").focus(function(){
                    a.trigger("focus");
                    b(this).hide()
                });
                b(a[0].form).submit(function(){
                    c.remove();
                    a.show()
                })
            }
        }
    };

    var e=!!("placeholder"in document.createElement("input"));
    b.fn.placeholder=function(){
        return e?this:this.each(function(){
            var a=b(this),c=new d(a);
            c.show(!0);
            a.focus(function(){
                c.hide()
            });
            a.blur(function(){
                c.show(!1)
            });
            b.browser.msie&&(b(window).load(function(){
                a.val()&&a.removeClass("placeholder");
                c.show(!0)
            }),
            a.focus(function(){
                if(this.value==""){
                    var a=this.createTextRange();
                    a.collapse(!0);
                    a.moveStart("character",0);
                    a.select()
                }
            }))
        })
    }
})(jQuery);
